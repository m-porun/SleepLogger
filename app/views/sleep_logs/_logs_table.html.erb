<tbody>
  <% (@start_date..@end_date).each do |date| %> <!-- 月初から月末までの日付を繰り返し処理する -->
    <% sleep_log = @sleep_logs.find { |log| log.date == date } || current_user.sleep_logs.find_or_initialize_by(date: date) %> <!-- その日付に合致する日付のログがあればその記録を使うし、なければその日付の入れ物を新たに作る（保存なし） -->
    <tr class="border border-secondary bg-primary">
      <td class="p-2 border border-secondary bg-primary"><%= date.day %></td>
      <td class="p-2 border border-secondary bg-primary"><%= %w[日 月 火 水 木 金 土][date.wday] %></td>
      <td class="p-2 border border-secondary bg-primary">
        <%= sleep_log.go_to_bed_at&.strftime('%H:%M') || "--:--" %>
      </td>

      <td class="p-2 border border-secondary bg-primary">
        <%= sleep_log.fell_asleep_at&.strftime('%H:%M') || "--:--" %>
      </td>

      <td class="p-2 border border-secondary bg-primary">
        <%= sleep_log.woke_up_at&.strftime('%H:%M') || "--:--" %>
      </td>

      <td class="p-2 border border-secondary bg-primary">
        <%= sleep_log.leave_bed_at&.strftime('%H:%M') || "--:--" %>
      </td>

      <td class="p-2 border border-secondary bg-primary">
        <%= calculate_sleep_duration(sleep_log.fell_asleep_at, sleep_log.woke_up_at) || "--:--" %> <!-- 就寝時刻〜覚醒時刻の睡眠時間を計算する -->
      </td>

      <td class="p-2 border border-secondary bg-primary">
        <%= sleep_log.awakening&.awakenings_count || 0 %>
      </td>

      <td class="p-2 border border-secondary bg-primary">
          <%= sleep_log.napping_time&.napping_time || 0 %>
      </td>

      <td class="p-1 border border-secondary bg-primary">
        <%= sleep_log.comment&.comment || '' %>
      </td>


      <td class="p-2 border border-secondary bg-primary">
        <% if sleep_log.persisted? %>
          <span class="material-symbols-outlined inline-flex">
            <%= link_to 'edit_square', edit_sleep_log_path(sleep_log) %>
          </span>
        <% else %>
          <span class="material-symbols-outlined inline-flex">
            <%= link_to 'edit_square', new_sleep_log_path(date: date.to_s) %> <!-- 日付を数値に一旦変換 -->
          </span>
        <% end %>
      </td>
    </tr>
  <% end %>
</tbody>